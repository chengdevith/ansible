- name: Setup NFS server
  hosts: localhost
  become: true

  vars: 
    nfs_remote_dir: /srv/nfs_shared

  tasks:
    - name: Update cache
      apt: 
        update_cache: yes

    - name: Install NFS Kernel server
      apt:
        name: nfs-kernel-server
        state: present

    - name: Create DIR to used
      file:
        path: "{{ nfs_remote_dir }}"
        state: directory
        owner: nobody
        group: nogroup
        mode: "0777"

# configuration inside /ect/exports (tell which user can use it)
    - name: Write config on /etc/exports
      lineinfile:
        path: /etc/exports
        line: "{{ nfs_remote_dir }} *(rw,sync,no_subtree_check,no_root_squash)"
        state: present
        create: yes

    - name: Apply configuration
      command: exportfs -ra

    - name: Restart nfs-kernel-server
      systemd:
        name: nfs-kernel-server
        enabled: true
        state: restarted